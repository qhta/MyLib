<UserControl x:Class="Qhta.UnicodeBuild.Views.WritingSystemsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:sf="http://schemas.syncfusion.com/wpf"
             xmlns:helpers="clr-namespace:Qhta.UnicodeBuild.Helpers"
             xmlns:resources="clr-namespace:Qhta.UnicodeBuild.Resources"
             xmlns:vm="clr-namespace:Qhta.UnicodeBuild.ViewModels"
             xmlns:models="clr-namespace:Qhta.Unicode.Models"
             xmlns:sys="clr-namespace:System.Globalization;assembly=System.Runtime"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
  <UserControl.Resources>
    <ContextMenu x:Key="WritingSystemsContextMenu">
      <MenuItem 
        Header="{x:Static resources:Strings.NewWritingSystem}" 
        Command="{Binding Source={StaticResource ViewModels}, 
          Path=Instance.AllWritingSystems.NewWritingSystemCommand}"/>
    </ContextMenu>
    <ContextMenu x:Key="WritingSystemsRowContextMenu">
      <MenuItem 
        Header="{x:Static resources:Strings.NewWritingSystem}" 
        Command="{Binding Source={StaticResource ViewModels}, 
          Path=Instance.AllWritingSystems.NewWritingSystemCommand}"/>
    </ContextMenu>
  </UserControl.Resources>
  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="200"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <!-- Menu Bar -->
    <Menu Grid.Row="0" Grid.ColumnSpan="2">
      <!--<MenuItem Header="File">
        <MenuItem Header="New" Command="New"/>
        <MenuItem Header="Open" Command="Open"/>
        <MenuItem Header="Save" Command="Save"/>
        <Separator/>
        <MenuItem Header="Exit" Command="Close"/>
      </MenuItem>-->
      <MenuItem Header="{x:Static resources:Strings.Edit}">
        <!--<MenuItem Header="Undo" Command="Undo"/>
        <MenuItem Header="Redo" Command="Redo"/>
        <Separator/>-->
        <MenuItem Header="{x:Static resources:Strings.Cut}" Command="Cut"/>
        <MenuItem Header="{x:Static resources:Strings.Copy}" Command="Copy"/>
        <MenuItem Header="{x:Static resources:Strings.Paste}" Command="Paste"/>
      </MenuItem>
      <!--<MenuItem Header="Tools">
        <MenuItem Header="Evaluate IsUsed" 
          Command="{Binding Source={StaticResource ViewModels}, 
          Path=Instance.AllWritingSystems.EvaluateIsUsedCommand}"/>
      </MenuItem>-->
      <MenuItem Header="{x:Static resources:Strings.Help}">
        <MenuItem Header="{x:Static resources:Strings.About}" Command="Help"/>
      </MenuItem>
    </Menu>

    <sf:SfTreeView  Grid.Column="0" Grid.Row="1"
                    x:Name="WritingSystemsTreeView"
                    DataContext ="{StaticResource ViewModels}"
                    ItemsSource ="{Binding Instance.TopWritingSystems}"
                    ChildPropertyName="Children"
                    Margin="0,0,5,0" 
                    SelectionChanged="WritingSystemsTreeView_OnSelectionChanged"
                    AutoExpandMode="AllNodes"
                    AllowDragging ="true"
                    AllowDrop ="True"
                    ItemDropped="WritingSystemsTreeView_OnItemDropped"
                    >

      <sf:SfTreeView.ItemTemplate>
        <DataTemplate DataType="{x:Type vm:WritingSystemViewModel}">
          <StackPanel Orientation="Horizontal">
            <StackPanel.ToolTip>
              <ToolTip>
                <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Width="200" />
              </ToolTip>
            </StackPanel.ToolTip>
            <Image Source="{Binding Type, Converter={StaticResource TypeToImageConverter}}"
                   Width="24" Height="24" Stretch="Uniform"/>
            <TextBlock Text="{Binding Name}"/>
          </StackPanel>
        </DataTemplate>
      </sf:SfTreeView.ItemTemplate>
    </sf:SfTreeView>
    <GridSplitter Grid.Column="0" Grid.Row="1"
                  Width="5"/>
    <sf:SfDataGrid Grid.Column="1" Grid.Row="1" 
                   x:Name="WritingSystemsDataGrid" 
                   DataContext ="{StaticResource ViewModels}"
                   ItemsSource ="{Binding Instance.AllWritingSystems}"
                   AllowDraggingColumns="True"
                   AllowEditing="True"
                   AllowFiltering="True"
                   AllowResizingColumns="True"
                   ColumnSizer="Auto"
                   HeaderRowHeight="26"
                   QueryRowHeight="DataGrid_OnQueryRowHeight"
                   AutoGenerateColumns="False"
                   SelectionUnit="Row"
                   SelectionChanged="WritingSystemsDataGrid_OnSelectionChanged"
                   EditTrigger="OnTap"
                   ContextMenu="{StaticResource WritingSystemsContextMenu}"
                   RecordContextMenu="{StaticResource WritingSystemsRowContextMenu}"
                   
                   >
      <sf:SfDataGrid.Columns>
        <sf:GridCheckBoxColumn
          Width="70"
          MappingName="IsUsed">
          <sf:GridColumn.HeaderTemplate>
            <DataTemplate>
              <TextBlock Text="{x:Static resources:Strings.WritingSystemIsUsed}" 
                         ToolTip="{x:Static resources:Strings.WritingSystemIsUsedTooltip}"  />
            </DataTemplate>
          </sf:GridColumn.HeaderTemplate>
        </sf:GridCheckBoxColumn>

        <sf:GridTextColumn 
          Width="150"
          MappingName="Name">
          <sf:GridColumn.HeaderTemplate>
            <DataTemplate>
              <TextBlock Text="{x:Static resources:Strings.WritingSystemName}" 
                         ToolTip="{x:Static resources:Strings.WritingSystemNameTooltip}"  />
            </DataTemplate>
          </sf:GridColumn.HeaderTemplate>
        </sf:GridTextColumn>

        <sf:GridComboBoxColumn
          DisplayMemberPath="FullName"
          SortMode="Display"
          MappingName="Parent"
          Width="150"
          ItemsSource="{Binding Source={StaticResource ViewModels}, 
            Path=Instance.SelectableWritingSystems}"
          >
          <sf:GridColumn.HeaderTemplate>
            <DataTemplate>
              <TextBlock Text="{x:Static resources:Strings.WritingSystemParent}" 
                         ToolTip="{x:Static resources:Strings.WritingSystemParentTooltip}"  />
            </DataTemplate>
          </sf:GridColumn.HeaderTemplate>
        </sf:GridComboBoxColumn>

        <sf:GridComboBoxColumn
          Width="100"
          SortMode="Display"
          MappingName="Type" 
          SelectedValuePath="Id"
          ItemsSource="{Binding Source={StaticResource ViewModels}, 
            Path=Instance.WritingSystemTypes}"
          >
          <sf:GridColumn.HeaderTemplate>
            <DataTemplate>
              <TextBlock Text="{x:Static resources:Strings.WritingSystemType}" 
                         ToolTip="{x:Static resources:Strings.WritingSystemTypeTooltip}"  />
            </DataTemplate>
          </sf:GridColumn.HeaderTemplate>
          <sf:GridComboBoxColumn.ItemTemplate>
            <DataTemplate DataType="{x:Type models:WritingSystemType}">
              <TextBlock Text="{Binding Type, 
                              Converter={StaticResource WritingSystemTypeResourceConverter},
                                  ConverterCulture={x:Static sys:CultureInfo.InvariantCulture}}"                        
                         ToolTip="{Binding Path=Type,
                              Converter={StaticResource WritingSystemTypeResourceConverter},
                              ConverterCulture={x:Static sys:CultureInfo.CurrentUICulture}, 
                              ConverterParameter=Tooltip}"  />
            </DataTemplate>          
          </sf:GridComboBoxColumn.ItemTemplate>
        </sf:GridComboBoxColumn>

        <sf:GridComboBoxColumn
          Width="100"
          SortMode="Display"
          MappingName="Kind"
          SelectedValuePath="Id"
          ItemsSource="{Binding Source={StaticResource ViewModels}, 
            Path=Instance.WritingSystemKinds}"
          >
          <sf:GridColumn.HeaderTemplate>
            <DataTemplate>
              <TextBlock Text="{x:Static resources:Strings.WritingSystemKind}" 
                         ToolTip="{x:Static resources:Strings.WritingSystemKindTooltip}"  />
            </DataTemplate>
          </sf:GridColumn.HeaderTemplate>
          <sf:GridComboBoxColumn.ItemTemplate>
            <DataTemplate DataType="{x:Type models:WritingSystemKind}">
              <TextBlock Text="{Binding Kind, 
                              Converter={StaticResource WritingSystemKindResourceConverter},
                                  ConverterCulture={x:Static sys:CultureInfo.InvariantCulture}}"                        
                         ToolTip="{Binding Path=Kind,
                              Converter={StaticResource WritingSystemKindResourceConverter},
                              ConverterCulture={x:Static sys:CultureInfo.CurrentUICulture}, 
                              ConverterParameter=Tooltip}"  />
            </DataTemplate>
          </sf:GridComboBoxColumn.ItemTemplate>
        </sf:GridComboBoxColumn>

        <sf:GridTextColumn 
          HeaderText="Key phrase" 
          MappingName="KeyPhrase"
          CellTemplate="{StaticResource TextCellTemplate}"/>
        <sf:GridTextColumn 
          HeaderText="Ctg" 
          MappingName="Ctg"
          Width="60"/>
        <sf:GridTextColumn 
          HeaderText="ISO" 
          MappingName="Iso"
          Width="60"/>
        <sf:GridTextColumn 
          HeaderText="Abbr" 
          MappingName="Abbr"
          Width="60"/>
        <sf:GridTextColumn 
          HeaderText="Ext" 
          MappingName="Ext"
          Width="60"/>
        <helpers:LongTextColumn 
          MappingName="Description" 
          HeaderText="Description"
          Width="420"
          TextWrapping="Wrap"
          VerticalAlignment="Top"
          CellTemplate="{StaticResource LongTextCellTemplate}"
          EditTemplate="{StaticResource LongTextEditTemplate}"/>
      </sf:SfDataGrid.Columns>
    </sf:SfDataGrid>
    <Button Grid.Row="1" Grid.Column="1" Width="32" Height="32"
            Background="Transparent"
            BorderThickness="0"
            BorderBrush="Transparent"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,20,20"
            Command="{Binding Source={StaticResource ViewModels}, 
              Path=Instance.AllWritingSystems.NewWritingSystemCommand}">
          <Image Source="/Assets/Add.png"/>
    </Button>
  </Grid>
</UserControl>

